{% extends 'partials/site_base.html' %}

{% block title %}
Submit Log
{% endblock %}

{% block content %}
<div>
    <h1 class="title">Log Entry Submission</h1>
</div>
<form id="log-submit-form" action="{{url_for('logs.new_log')}}">
    <p><label for="user-id">User Name:</label>
        <select name="user-id">
            {% for user in users %}
            <option value="{{ user.id }}">{{ user.name }}</option>
            {% endfor %}
        </select>
    </p>
    <p><label for="instrument">Instrument:</label>
        <select name="instrument">
            {% for instrument in instruments %}
            <option value="{{ instrument.id }}">{{ instrument.name }}</option>
            {% endfor %}
        </select>
    </p>
    <p><label for="time">Date/Time:</label>
        <input type="datetime" id="datetime-input" name="time">
        UTC Time (YYYY-MM-DD HH:MM:SS)
        {% if error %}
        <div id="new-log-error" style="color: red">{{error}}</div>
        {% endif %}

    </p>

    <p> <label for="status">Log Status</label>
        <select name="status">
            {% for key, value in status.iteritems() %}
            <option value="{{key}}">{{value}}</option>
            {% endfor %}
        </select>
    </p>
    <p> <label for="contents">Log Contents:</label><br>
        <textarea style="width: 80%;height: 25em;" name="contents"></textarea>
    </p>
    <p>
        <input id="submit" type="submit" value="Submit Log">
    </p>
</form>
{% endblock %}

{% block script %}
<script>
    //Catch the date as it's submitted and convert to UTC for the database.
    $(function() {$('#log-submit-form').submit(function()
    {
        str = document.getElementById("datetime-input").value;

        //Reduce lengths of spaces to one space, then trim outside spaces
        var clean_str = str.replace(/\s{2,}/g, ' ').trim();

        //Now add a 'T' between the date and time, and a 'Z' on the end.  Makes it a proper ISO format string.
        var iso_str = clean_str.split(' ').join('T') + 'Z'

        //Now parse the string into a date
        date = new Date(Date.parse(iso_str));

        document.getElementById("datetime-input").value = date.toUTCString();
    });
    });

    //Get the current time and convert it from format "yyyy-mm-ddTHH:MM:SSZ" to the more readable "yyyy-mm-dd HH:MM:SS"
    var current_time = new Date().toISOString().split('.')[0].split('T').join(' ')

    document.getElementById('datetime-input').value = current_time;
    document.getElementById('datetime-input').placeholder = current_time;
</script>
{% endblock %}
