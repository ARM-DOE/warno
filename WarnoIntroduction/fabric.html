

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Fabric &mdash; WARNO 0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="WARNO 0.1 documentation" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> WARNO</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#fabric">Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#design">Design</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#before-you-start">Before you Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#start-up-configuration">Start Up Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#nfs-permissions">NFS Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#multiple-vm-s-one-one-machine">Multiple VM&#8217;s one one machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#start-up">Start Up</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#demo-data">Demo Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#user-portal-access">User Portal Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#valid-columns-for-graphs">Valid Columns for graphs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../WarnoVagrant/index.html">Latest Release</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../WarnoVagrant/WarnoConfig/index.html">WARNO Config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../WarnoVagrant/Agent/index.html">Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../WarnoVagrant/UserPortal/index.html">User Portal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../WarnoVagrant/EventManager/index.html">Event Manager</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../indices.html">Indices and tables</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">WARNO</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Fabric</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/WarnoIntroduction/fabric.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="fabric">
<h1>Fabric<a class="headerlink" href="#fabric" title="Permalink to this headline">¶</a></h1>
<p>Fabric allows the manipulation of WARNO vms remotely.</p>
<p>Environment
First, running the Fabric script works best when run from the directory that
fabfile.py is located in.</p>
<p>Second, this Fabric script requires that you set the environment variable
&#8220;DEPLOY_CONFIG_PATH&#8221; to point to a configuration directory.  The configuration
directory has a top level &#8220;secrets.yml&#8221; that will be pushed to all hosts, as well
as a sub directory for each host, with the same name as the host.  The path must
end with a trailing &#8220;/&#8221; or the script may run into parsing errors.</p>
<p>Each directory can have it&#8217;s own &#8220;config.yml&#8221;, rsa key pair, or zipped database
dump file.  When Fabric executes for a host, it first checks for the host-specific
configuration file, then for a top level default in the main configuration
directory before abandoning.</p>
<div class="section" id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span>fab &lt;command&gt;:arg1=val1,arg2=val2 -H &lt;host1&gt;,&lt;host2&gt;
</pre></div>
</div>
<p>For the vast majority of commands run, it should be fine to use the default values,
simplifying it to:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>fab &lt;command&gt; -H &lt;host&gt;
</pre></div>
</div>
</div>
<div class="section" id="current-commands">
<h2>Current commands<a class="headerlink" href="#current-commands" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>push_config</strong>:  Pushes a &#8220;config.yml&#8221; file from the calling directory into WARNO&#8217;s
default location for the file.</li>
<li><strong>push_keys</strong>:  Pushes a pair of ssh keys, default &#8220;id_rsa&#8221; and &#8220;id_rsa.pub&#8221;.</li>
<li><strong>push_secrets</strong>: Pushes &#8220;secrets.yml&#8221; in the same fashion as push_config.</li>
<li><strong>push_ssl_ca</strong>: Pushes a personal Certificate Authority bundle to the remote host
if it exists.</li>
<li><strong>push_ssl_certs</strong>: Pushes a local ssl certificate and its private key to the
remote host, if they exist.</li>
<li><strong>push_db_dump</strong>: Pushes &#8220;db_dump.data.gz&#8221; in the same fashion as push_config.</li>
<li><strong>start_application</strong>: Starts the Vagrant machine (vagrant up).</li>
<li><strong>stop_application</strong>: Stops the Vagrant machine (vagrant halt).</li>
<li><strong>reload_application</strong>: Reloads the Vagrant machine (vagrant reload).</li>
<li><strong>destroy_application</strong>: Destroys the Vagrant machine (vagrant destroy -f).</li>
<li><strong>purge_application</strong>: Destroys the Vagrant machine and forcibly removes the
containing folder and all files.</li>
<li><strong>push_and_replace_database</strong>: Calls push_db_dump, then calls destroy_application
and start_application. This forces the application to reload the database dump
file as the database.</li>
<li><strong>gen_and_push_ssl_certs</strong>: Generates an ssl certificate and its private key from
the local custom Certificate Authority (CA) if they are not already present in
the host&#8217;s directory.  Then pushes the cert and key in the host&#8217;s directory and
the local CA file into the remote host.</li>
<li><strong>update_application</strong>: The heavy hitter.  If the directory for the application
does not exist, creates it and moves into it. Then, if the git repository does
not already exist, clones the git repository into the directory.  If a Vagrant
machine is already running, it then halts the machine to preserve the database.
If &#8220;config.yml&#8221;, the ssh keys, or &#8220;secrets.yml&#8221; exist in the calling directory,
they are then pushed into the application directory (push_config, push_keys,
push_secrets). Next it pushes an ssl certificate and its key if they exist, and
if they don&#8217;t, it will attempt to generate and push an ssl certificate and its
key from a local Certificate Authority bundle (gen_and_push_ssl_certs, unless
certificate generation is explicitly disabled). After everything is in place,
it then starts the application (start_application).</li>
</ul>
</div>
<div class="section" id="default-configuration">
<h2>Default Configuration<a class="headerlink" href="#default-configuration" title="Permalink to this headline">¶</a></h2>
<p>The default configuration is meant to work in tandem with <a class="reference external" href="http://overwatch.pnl.gov/schuman/warno-configuration">warno-configuration</a>.  The directory structure
is explained on the README.</p>
<p>The Fabric commands are designed to be run from the directory where fabfile.py
is located.</p>
</div>
<div class="section" id="custom-file-paths">
<h2>Custom File Paths<a class="headerlink" href="#custom-file-paths" title="Permalink to this headline">¶</a></h2>
<p>You can change the path prefix by setting the environment variable DEPLOY_CONFIG_PATH, pointing to wherever you have
cloned the configuration directory.</p>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Joseph Hardin.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>